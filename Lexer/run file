#!/bin/bash


LEXER_EXEC="./src/lexer"


TEST_DIR="./test"
OUTPUT_DIR="./output"


if [ ! -f "$LEXER_EXEC" ]; then
    echo "Error: Lexer executable not found at $LEXER_EXEC"
    echo "Please build the lexer first using 'make lexer'"
    exit 1
fi


mkdir -p "$OUTPUT_DIR"


for TEST_FILE in "$TEST_DIR"/*; do
    if [ -f "$TEST_FILE" ]; then
        BASENAME=$(basename "$TEST_FILE")
        OUTPUT_FILE="$OUTPUT_DIR/${BASENAME%.*}.out"
        echo "Running lexer on $BASENAME..."
        "$LEXER_EXEC" < "$TEST_FILE" > "$OUTPUT_FILE"
        echo "Output written to $OUTPUT_FILE"
    fi
done

echo "All test cases processed."
